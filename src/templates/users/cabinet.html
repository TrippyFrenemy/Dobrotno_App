{% extends "base.html" %}
{% block title %}–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç{% endblock %}

{% block content %}
<h2 class="text-2xl font-semibold mb-4">üíº –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç: {{ user.name | e }}</h2>

<!-- –§–∏–ª—å—Ç—Ä –ø–µ—Ä–∏–æ–¥–∞ -->
<form method="get" class="mb-6 flex gap-4 items-end">
  <div>
    <label class="block text-sm font-medium text-gray-700">–ü–æ–∫–∞–∑–∞—Ç—å –º–µ—Å—è—Ü–µ–≤</label>
    <select name="months" class="border p-2 rounded">
      <option value="1" {% if months == 1 %}selected{% endif %}>1 –º–µ—Å—è—Ü</option>
      <option value="3" {% if months == 3 %}selected{% endif %}>3 –º–µ—Å—è—Ü–∞</option>
      <option value="6" {% if months == 6 %}selected{% endif %}>6 –º–µ—Å—è—Ü–µ–≤</option>
      <option value="12" {% if months == 12 %}selected{% endif %}>12 –º–µ—Å—è—Ü–µ–≤</option>
    </select>
  </div>
  <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">–ü–æ–∫–∞–∑–∞—Ç—å</button>
  <a href="/users/me" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">–ù–∞–∑–∞–¥ –∫ –∞–∫–∫–∞—É–Ω—Ç—É</a>
</form>

<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
<div class="bg-blue-50 p-4 rounded border border-blue-200 mb-6">
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div>
      <div class="text-sm text-gray-600">–†–æ–ª—å</div>
      <div class="text-lg font-semibold">
        {% if user.role == 'admin' %}–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
        {% elif user.role == 'manager' %}–ú–µ–Ω–µ–¥–∂–µ—Ä
        {% else %}–°–æ—Ç—Ä—É–¥–Ω–∏–∫{% endif %}
      </div>
    </div>
    {% if user.role in ['manager', 'admin'] %}
    <div>
      <div class="text-sm text-gray-600">–°—Ç–∞–≤–∫–∞</div>
      <div class="text-lg font-semibold">{{ "%.2f"|format(user.default_rate) }} –≥—Ä–Ω/–¥–µ–Ω—å</div>
    </div>
    <div>
      <div class="text-sm text-gray-600">–ü—Ä–æ—Ü–µ–Ω—Ç</div>
      <div class="text-lg font-semibold">{{ "%.1f"|format(user.default_percent) }}%</div>
    </div>
    {% endif %}
  </div>
</div>

<!-- –ó–∞—Ä–ø–ª–∞—Ç–∞ –ø–æ –º–µ—Å—è—Ü–∞–º -->
<h3 class="text-xl font-semibold mb-3">üí∞ –ó–∞—Ä–ø–ª–∞—Ç–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ {{ months }} –º–µ—Å—è—Ü–µ–≤</h3>
<table class="w-full text-sm border mb-8">
  <thead class="bg-gray-100">
    <tr>
      <th class="p-2 border">–ú–µ—Å—è—Ü</th>
      {% if user.role == 'employee' %}
      <th class="p-2 border">–ó–∞ —Å–º–µ–Ω—ã</th>
      {% else %}
      <th class="p-2 border">–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è</th>
      {% endif %}
      <th class="p-2 border">–®—Ç—Ä–∞—Ñ—ã</th>
      <th class="p-2 border">–ò—Ç–æ–≥–æ</th>
    </tr>
  </thead>
  <tbody>
    {% for data in monthly_data %}
    <tr>
      <td class="p-2 border font-medium">{{ data.month_name }} {{ data.year }}</td>
      {% if user.role == 'employee' %}
      <td class="p-2 border text-right">{{ "%.2f"|format(data.shifts_salary) }} –≥—Ä–Ω</td>
      {% else %}
      <td class="p-2 border text-right">{{ "%.2f"|format(data.manager_salary) }} –≥—Ä–Ω</td>
      {% endif %}
      <td class="p-2 border text-right {% if data.penalties > 0 %}text-red-600 font-semibold{% endif %}">
        {% if data.penalties > 0 %}-{% endif %}{{ "%.2f"|format(data.penalties) }} –≥—Ä–Ω
      </td>
      <td class="p-2 border text-right font-bold">{{ "%.2f"|format(data.total) }} –≥—Ä–Ω</td>
    </tr>
    {% endfor %}
  </tbody>
  <tfoot class="bg-gray-50 font-bold">
    <tr>
      <td class="p-2 border">–í—Å–µ–≥–æ:</td>
      {% if user.role == 'employee' %}
      <td class="p-2 border text-right">{{ "%.2f"|format(monthly_data|sum(attribute='shifts_salary')) }} –≥—Ä–Ω</td>
      {% else %}
      <td class="p-2 border text-right">{{ "%.2f"|format(monthly_data|sum(attribute='manager_salary')) }} –≥—Ä–Ω</td>
      {% endif %}
      <td class="p-2 border text-right text-red-600">
        -{{ "%.2f"|format(monthly_data|sum(attribute='penalties')) }} –≥—Ä–Ω
      </td>
      <td class="p-2 border text-right">{{ "%.2f"|format(monthly_data|sum(attribute='total')) }} –≥—Ä–Ω</td>
    </tr>
  </tfoot>
</table>

<!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ —à—Ç—Ä–∞—Ñ—ã -->
{% if recent_penalties %}
<h3 class="text-xl font-semibold mb-3">‚ö†Ô∏è –ü–æ—Å–ª–µ–¥–Ω–∏–µ —à—Ç—Ä–∞—Ñ—ã (–∑–∞ 90 –¥–Ω–µ–π)</h3>
<table class="w-full text-sm border">
  <thead class="bg-gray-100">
    <tr>
      <th class="p-2 border">–î–∞—Ç–∞</th>
      <th class="p-2 border">–°—É–º–º–∞</th>
      <th class="p-2 border">–ü—Ä–∏—á–∏–Ω–∞</th>
    </tr>
  </thead>
  <tbody>
    {% for penalty in recent_penalties %}
    <tr>
      <td class="p-2 border">{{ penalty.date | e }}</td>
      <td class="p-2 border text-right text-red-600 font-semibold">-{{ "%.2f"|format(penalty.amount) }} –≥—Ä–Ω</td>
      <td class="p-2 border">{{ penalty.reason | e }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<div class="bg-green-50 p-4 rounded border border-green-200 text-center">
  <p class="text-green-700 font-medium">‚úÖ –£ –≤–∞—Å –Ω–µ—Ç —à—Ç—Ä–∞—Ñ–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 90 –¥–Ω–µ–π!</p>
</div>
{% endif %}

<div class="mt-6">
  <p class="text-sm text-gray-600">
    <strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong> –î–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –ø–æ–∫–∞–∑–∞–Ω–∞ —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∫–∞–ª—å–∫—É–ª—è—Ü–∏—è. –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–∏ –∏ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –º–µ—Å—è—á–Ω—ã—Ö –æ—Ç—á–µ—Ç–∞—Ö.
  </p>
</div>

{% endblock %}
