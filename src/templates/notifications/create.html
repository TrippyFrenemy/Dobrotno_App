{% extends "base.html" %}
{% block title %}–°–æ–∑–¥–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
  <h2 class="text-2xl font-semibold mb-6">üìù –°–æ–∑–¥–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</h2>

  <form method="post" action="/notifications/create" class="bg-white rounded-lg shadow p-6 space-y-4">
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

    <!-- –ü–æ–ª—É—á–∞—Ç–µ–ª–∏ -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">–ü–æ–ª—É—á–∞—Ç–µ–ª–∏</label>
      <div class="mb-2">
        <label class="inline-flex items-center">
          <input type="radio" name="recipient_type" value="all" checked
                 class="form-radio"
                 onchange="document.getElementById('user_ids').value = 'all'; document.getElementById('user_select').disabled = true;">
          <span class="ml-2">–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
        </label>
      </div>
      <div class="mb-2">
        <label class="inline-flex items-center">
          <input type="radio" name="recipient_type" value="selected"
                 class="form-radio"
                 onchange="document.getElementById('user_ids').value = ''; document.getElementById('user_select').disabled = false;">
          <span class="ml-2">–í—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
        </label>
      </div>

      <select id="user_select" name="selected_users" multiple disabled
              class="w-full border rounded p-2 mt-2"
              size="6"
              onchange="updateUserIds()">
        {% for u in users %}
        <option value="{{ u.id }}">{{ u.name }} ({{ u.email }})</option>
        {% endfor %}
      </select>
      <input type="hidden" id="user_ids" name="user_ids" value="all">
      <p class="text-xs text-gray-500 mt-1">–î–ª—è –≤—ã–±–æ—Ä–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —É–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ Ctrl (Cmd –Ω–∞ Mac)</p>
    </div>

    <!-- –¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">–¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</label>
      <select name="type" class="w-full border rounded p-2">
        <option value="info">‚Ñπ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</option>
        <option value="success">‚úì –£—Å–ø–µ—Ö</option>
        <option value="warning">‚ö† –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ</option>
        <option value="error">‚úó –û—à–∏–±–∫–∞</option>
      </select>
    </div>

    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
      <input type="text" name="title" required
             class="w-full border rounded p-2"
             placeholder="–ö—Ä–∞—Ç–∫–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è">
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">–°–æ–æ–±—â–µ–Ω–∏–µ</label>
      <textarea name="message" rows="4" required
                class="w-full border rounded p-2"
                placeholder="–¢–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"></textarea>
    </div>

    <!-- –°—Å—ã–ª–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">–°—Å—ã–ª–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
      <input type="text" name="related_url"
             class="w-full border rounded p-2"
             placeholder="/orders/all/list –∏–ª–∏ https://example.com">
      <p class="text-xs text-gray-500 mt-1">–£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∏–ª–∏ –ø–æ–ª–Ω—ã–π URL –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞</p>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <div class="flex gap-3">
      <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">
        –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      </button>
      <a href="/notifications" class="bg-gray-300 text-gray-700 px-6 py-2 rounded hover:bg-gray-400">
        –û—Ç–º–µ–Ω–∞
      </a>
    </div>
  </form>
</div>

<script>
function updateUserIds() {
  const select = document.getElementById('user_select');
  const selected = Array.from(select.selectedOptions).map(option => option.value);
  document.getElementById('user_ids').value = selected.join(',');
}
</script>
{% endblock %}
