{% extends "base.html" %}
{% block title %}–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-semibold">üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h2>
    <div class="flex gap-2">
      {% if user.role == 'admin' %}
      <a href="/notifications/create" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
        + –°–æ–∑–¥–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      </a>
      {% endif %}
      {% if unread_count > 0 %}
      <form method="post" action="/notifications/read-all" class="inline">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
          –ü—Ä–æ—á–∏—Ç–∞—Ç—å –≤—Å–µ ({{ unread_count }})
        </button>
      </form>
      {% endif %}
    </div>
  </div>

  <!-- –§–∏–ª—å—Ç—Ä -->
  <div class="mb-4 flex gap-3">
    <a href="/notifications?unread_only=false"
       class="px-4 py-2 rounded {% if not unread_only %}bg-blue-600 text-white{% else %}bg-gray-200 text-gray-700{% endif %}">
      –í—Å–µ ({{ total }})
    </a>
    <a href="/notifications?unread_only=true"
       class="px-4 py-2 rounded {% if unread_only %}bg-blue-600 text-white{% else %}bg-gray-200 text-gray-700{% endif %}">
      –ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ ({{ unread_count }})
    </a>
  </div>

  <!-- –°–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
  {% if notifications %}
  <div class="space-y-3">
    {% for notification in notifications %}
    <div class="bg-white rounded-lg shadow-sm border
                {% if not notification.is_read %}border-l-4 border-l-blue-500 bg-blue-50{% else %}border-gray-200{% endif %}
                p-4 hover:shadow-md transition">
      <div class="flex justify-between items-start">
        <div class="flex-1">
          <!-- –¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
          <div class="flex items-center gap-2 mb-1">
            {% if notification.type == 'success' %}
            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
              ‚úì –£—Å–ø–µ—Ö
            </span>
            {% elif notification.type == 'warning' %}
            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800">
              ‚ö† –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
            </span>
            {% elif notification.type == 'error' %}
            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800">
              ‚úó –û—à–∏–±–∫–∞
            </span>
            {% else %}
            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">
              ‚Ñπ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            </span>
            {% endif %}

            <span class="text-xs text-gray-500">
              {{ notification.created_at.strftime('%d.%m.%Y %H:%M') }}
            </span>
          </div>

          <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
          <h3 class="font-semibold text-gray-900 mb-1">{{ notification.title | e }}</h3>

          <!-- –°–æ–æ–±—â–µ–Ω–∏–µ -->
          <p class="text-gray-700 text-sm mb-2">{{ notification.message | e }}</p>

          <!-- –°—Å—ã–ª–∫–∞ -->
          {% if notification.related_url %}
          <a href="{{ notification.related_url }}" class="text-blue-600 hover:underline text-sm">
            –ü–µ—Ä–µ–π—Ç–∏ ‚Üí
          </a>
          {% endif %}
        </div>

        <!-- –î–µ–π—Å—Ç–≤–∏—è -->
        <div class="flex gap-2 ml-4">
          {% if not notification.is_read %}
          <form method="post" action="/notifications/{{ notification.id }}/read" class="inline">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            <button type="submit"
                    class="text-blue-600 hover:text-blue-800 text-sm font-medium"
                    title="–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ">
              ‚úì
            </button>
          </form>
          {% endif %}
          <form method="post" action="/notifications/{{ notification.id }}/delete"
                onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ?');"
                class="inline">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            <button type="submit"
                    class="text-red-600 hover:text-red-800 text-sm font-medium"
                    title="–£–¥–∞–ª–∏—Ç—å">
              ‚úó
            </button>
          </form>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
  {% if total_pages > 1 %}
  <div class="mt-6 flex justify-center gap-2">
    {% if page > 1 %}
    <a href="/notifications?page={{ page - 1 }}&unread_only={{ unread_only }}"
       class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">
      ‚Üê –ù–∞–∑–∞–¥
    </a>
    {% endif %}

    <span class="px-4 py-2 bg-blue-600 text-white rounded">
      –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page }} –∏–∑ {{ total_pages }}
    </span>

    {% if page < total_pages %}
    <a href="/notifications?page={{ page + 1 }}&unread_only={{ unread_only }}"
       class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">
      –í–ø–µ—Ä–µ–¥ ‚Üí
    </a>
    {% endif %}
  </div>
  {% endif %}

  {% else %}
  <div class="bg-white rounded-lg shadow p-8 text-center">
    <p class="text-gray-600 mb-2">üì≠ –ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</p>
    <p class="text-sm text-gray-500">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç {% if unread_only %}–Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö {% endif %}—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</p>
  </div>
  {% endif %}

  <div class="mt-6">
    <a href="/dashboard" class="text-blue-600 hover:underline">‚Üê –ù–∞–∑–∞–¥ –∫ –¥–∞—à–±–æ—Ä–¥—É</a>
  </div>
</div>
{% endblock %}
