{% extends "base.html" %}
{% block title %}–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: {{ order_type.name }}{% endblock %}

{% block content %}
<h2 class="text-2xl font-semibold mb-4">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: {{ order_type.name | e }}</h2>

<!-- –§–∏–ª—å—Ç—Ä –ø–µ—Ä–∏–æ–¥–∞ -->
<form method="get" class="mb-6 flex gap-4 items-end">
  <div>
    <label class="block text-sm font-medium text-gray-700">–ü–µ—Ä–∏–æ–¥ (–¥–Ω–µ–π)</label>
    <select name="days" class="border p-2 rounded">
      <option value="7" {% if days == 7 %}selected{% endif %}>7 –¥–Ω–µ–π</option>
      <option value="14" {% if days == 14 %}selected{% endif %}>14 –¥–Ω–µ–π</option>
      <option value="30" {% if days == 30 %}selected{% endif %}>30 –¥–Ω–µ–π</option>
      <option value="60" {% if days == 60 %}selected{% endif %}>60 –¥–Ω–µ–π</option>
      <option value="90" {% if days == 90 %}selected{% endif %}>90 –¥–Ω–µ–π</option>
      <option value="180" {% if days == 180 %}selected{% endif %}>180 –¥–Ω–µ–π</option>
      <option value="365" {% if days == 365 %}selected{% endif %}>–ì–æ–¥</option>
    </select>
  </div>
  <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">–ü–æ–∫–∞–∑–∞—Ç—å</button>
  <a href="/order-types/" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">–ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
</form>

<!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
  <div class="bg-blue-50 p-4 rounded border border-blue-200">
    <div class="text-sm text-gray-600">–ö–æ–º–∏—Å—Å–∏—è —Ç–∏–ø–∞</div>
    <div class="text-2xl font-bold text-blue-700">{{ "%.0f"|format(order_type.commission_percent) }}%</div>
  </div>
  <div class="bg-green-50 p-4 rounded border border-green-200">
    <div class="text-sm text-gray-600">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
    <div class="text-2xl font-bold text-green-700">{{ total_count }}</div>
  </div>
  <div class="bg-purple-50 p-4 rounded border border-purple-200">
    <div class="text-sm text-gray-600">–û–±—â–∞—è —Å—É–º–º–∞</div>
    <div class="text-2xl font-bold text-purple-700">{{ "%.2f"|format(total_amount) }} –≥—Ä–Ω</div>
  </div>
  <div class="bg-orange-50 p-4 rounded border border-orange-200">
    <div class="text-sm text-gray-600">–°—Ä–µ–¥–Ω–∏–π –∑–∞–∫–∞–∑</div>
    <div class="text-2xl font-bold text-orange-700">{{ "%.2f"|format(avg_amount) }} –≥—Ä–Ω</div>
  </div>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–Ω—è–º -->
{% if daily_stats %}
<h3 class="text-xl font-semibold mb-3">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–Ω—è–º ({{ start_date | e }} ‚Äî {{ end_date | e }})</h3>
<table class="w-full text-sm border mb-8">
  <thead class="bg-gray-100">
    <tr>
      <th class="p-2 border">–î–∞—Ç–∞</th>
      <th class="p-2 border">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤</th>
      <th class="p-2 border">–°—É–º–º–∞</th>
    </tr>
  </thead>
  <tbody>
    {% for day in daily_stats %}
    <tr>
      <td class="p-2 border">{{ day.date | e }}</td>
      <td class="p-2 border text-center">{{ day.count }}</td>
      <td class="p-2 border text-right">{{ "%.2f"|format(day.amount) }} –≥—Ä–Ω</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p class="italic text-gray-600 mb-8">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥.</p>
{% endif %}

<!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã -->
{% if recent_orders %}
<h3 class="text-xl font-semibold mb-3">üïí –ü–æ—Å–ª–µ–¥–Ω–∏–µ 20 –∑–∞–∫–∞–∑–æ–≤</h3>
<table class="w-full text-sm border">
  <thead class="bg-gray-100">
    <tr>
      <th class="p-2 border">‚Ññ</th>
      <th class="p-2 border">–î–∞—Ç–∞</th>
      <th class="p-2 border">–¢–µ–ª–µ—Ñ–æ–Ω</th>
      <th class="p-2 border">–°—É–º–º–∞</th>
    </tr>
  </thead>
  <tbody>
    {% for order in recent_orders %}
    <tr>
      <td class="p-2 border">{{ loop.index }}</td>
      <td class="p-2 border">{{ order.date | e }}</td>
      <td class="p-2 border">{{ order.phone_number | e }}</td>
      <td class="p-2 border text-right">{{ order.amount | e }} –≥—Ä–Ω</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p class="italic text-gray-600">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ —ç—Ç–æ–≥–æ —Ç–∏–ø–∞.</p>
{% endif %}

{% endblock %}
