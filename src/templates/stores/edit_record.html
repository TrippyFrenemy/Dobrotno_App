{% extends "base.html" %}
{% block title %}Изменить запись{% endblock %}
{% block content %}
<div class="max-w-lg mx-auto bg-white p-6 rounded shadow">
  <h2 class="text-xl font-semibold mb-4">Изменить запись</h2>
  <form method="post" class="flex flex-col gap-4">
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

    <!-- Дата (только для просмотра) -->
    <input type="date" name="date_" value="{{ record.date }}" required class="border p-2 rounded" readonly />

    <!-- Поля ввода сумм -->
    <input type="number" step="0.01" name="cash" value="{{ record.cash }}" required class="border p-2 rounded" />
    {% if record.cash or record.comments.get('cash') %}
    <input type="text" name="cash_comment" value="{{ record.comments.get('cash','') }}" class="border p-2 rounded" />
    {% endif %}

    <input type="number" step="0.01" name="cash_on_hand" value="{{ record.cash_on_hand }}" required class="border p-2 rounded" />
    {% if record.cash_on_hand or record.comments.get('cash_on_hand') %}
    <input type="text" name="cash_on_hand_comment" value="{{ record.comments.get('cash_on_hand','') }}" class="border p-2 rounded" />
    {% endif %}

    <input type="number" step="0.01" name="terminal" value="{{ record.terminal }}" required class="border p-2 rounded" />
    {% if record.terminal or record.comments.get('terminal') %}
    <input type="text" name="terminal_comment" value="{{ record.comments.get('terminal','') }}" class="border p-2 rounded" />
    {% endif %}

    <input type="number" step="0.01" name="changed_price" value="{{ record.changed_price }}" class="border p-2 rounded" />
    {% if record.changed_price or record.comments.get('changed_price') %}
    <input type="text" name="changed_price_comment" value="{{ record.comments.get('changed_price','') }}" class="border p-2 rounded" />
    {% endif %}

    <input type="number" step="0.01" name="discount" value="{{ record.discount }}" class="border p-2 rounded" />
    {% if record.discount or record.comments.get('discount') %}
    <input type="text" name="discount_comment" value="{{ record.comments.get('discount','') }}" class="border p-2 rounded" />
    {% endif %}

    <input type="number" step="0.01" name="promotion" value="{{ record.promotion }}" class="border p-2 rounded" />
    {% if record.promotion or record.comments.get('promotion') %}
    <input type="text" name="promotion_comment" value="{{ record.comments.get('promotion','') }}" class="border p-2 rounded" />
    {% endif %}

    <input type="number" step="0.01" name="to_store" value="{{ record.to_store }}" class="border p-2 rounded" />
    {% if record.to_store or record.comments.get('to_store') %}
    <input type="text" name="to_store_comment" value="{{ record.comments.get('to_store','') }}" class="border p-2 rounded" />
    {% endif %}

    <input type="number" step="0.01" name="refund" value="{{ record.refund }}" class="border p-2 rounded" />
    {% if record.refund or record.comments.get('refund') %}
    <input type="text" name="refund_comment" value="{{ record.comments.get('refund','') }}" class="border p-2 rounded" />
    {% endif %}

    <input type="number" step="0.01" name="service" value="{{ record.service }}" class="border p-2 rounded" />
    {% if record.service or record.comments.get('service') %}
    <input type="text" name="service_comment" value="{{ record.comments.get('service','') }}" class="border p-2 rounded" />
    {% endif %}

    <input type="number" step="0.01" name="receipt" value="{{ record.receipt }}" class="border p-2 rounded" />
    {% if record.receipt or record.comments.get('receipt') %}
    <input type="text" name="receipt_comment" value="{{ record.comments.get('receipt','') }}" class="border p-2 rounded" />
    {% endif %}

    <!-- Сотрудники магазина -->
    <label>Сотрудники магазина</label>
    <select name="store_employees" multiple required class="border p-2 rounded h-40">
      {% for emp in store_employees %}
      <option value="{{ emp.id }}" {% if emp.id in selected_store %}selected{% endif %}>{{ emp.name | e }}</option>
      {% endfor %}
    </select>

    <!-- Сотрудники склада -->
    <label>Сотрудники склада</label>
    <select name="warehouse_employees" multiple required class="border p-2 rounded h-40">
      <option value="">---</option>
      {% for emp in warehouse_employees %}
      <option value="{{ emp.id }}" {% if emp.id in selected_warehouse %}selected{% endif %}>{{ emp.name | e }}</option>
      {% endfor %}
    </select>

    <button type="submit" class="bg-green-600 text-white py-2 rounded hover:bg-green-700">Сохранить</button>
  </form>
</div>
{% endblock %}
